<script>
let onboardingData = {};

// Allocation profiles with projected real returns (after inflation)
const allocationProfiles = {
    "Aggressive": 0.07,   // 100% Equities
    "Moderate": 0.05,     // 60/40 Split
    "Conservative": 0.03  // Bonds/Cash heavy
};

function calculateFIRE() {
    // Collect new variables (defaults provided if missing)
    const inflation = 0.03; 
    const taxRate = onboardingData.taxRate || 0.15;
    const allocation = onboardingData.allocation || "Moderate";
    const realReturn = allocationProfiles[allocation];

    // Refine Expense Math: Adjusted for Tax
    // If you need $50k post-tax, you need to withdraw $50k / (1 - taxRate)
    const monthlyNeeded = onboardingData.monthlyExpenses || 3000;
    const annualPostTaxSpending = monthlyNeeded * 12;
    const annualGrossWithdrawal = annualPostTaxSpending / (1 - taxRate);
    
    // The FI Target (25x Rule applied to Gross Withdrawal)
    const fiTarget = annualGrossWithdrawal * 25;
    
    let yearsToRetirement = "N/A";
    let targetFIDate = "N/A";

    const currentSavings = onboardingData.currentSavings || 0;
    const monthlySavings = onboardingData.monthlySavings || 0;

    if (currentSavings > 0 || monthlySavings > 0) {
        // Solving for Time in the compound interest formula with monthly contributions
        // FV = PV(1+r)^n + PMT[((1+r)^n - 1) / r]
        const r = realReturn / 12;
        const pmt = monthlySavings;
        const pv = currentSavings;
        
        // Logarithmic approximation for years to reach target
        const nMonths = Math.log((fiTarget * r + pmt) / (pv * r + pmt)) / Math.log(1 + r);
        yearsToRetirement = (nMonths / 12).toFixed(1);
        
        const currentYear = new Date().getFullYear();
        targetFIDate = Math.ceil(currentYear + parseFloat(yearsToRetirement));
    }

    // Update Dashboard UI
    document.getElementById('chat-interface').style.display = 'none';
    document.getElementById('dashboard').style.display = 'block';
    
    document.getElementById('fi-target-value').innerText = `$${Math.round(fiTarget).toLocaleString()}`;
    document.getElementById('years-to-retirement').innerText = yearsToRetirement;
    document.getElementById('target-fi-date').innerText = targetFIDate;
    
    // Display the strategy used
    document.getElementById('strategy-label').innerText = `${allocation} (${(realReturn * 100).toFixed(0)}% real return)`;
}
</script>
    
    <div id="dashboard" class="hidden p-6 bg-gray-900 text-white min-h-screen">
        <h2 class="text-3xl font-bold mb-6 text-center text-teal-400">Your FIRE Dashboard</h2>
        <div class="mb-8 p-4 bg-gray-800 rounded-lg shadow-lg">
            <div class="flex justify-between items-center mb-2">
                <span class="text-gray-400">Progress to FI Number</span>
                <span id="progress-percentage" class="font-bold text-teal-400">0%</span>
            </div>
            <div class="w-full bg-gray-700 rounded-full h-4 mb-4">
                <div id="progress-bar" class="bg-teal-500 h-4 rounded-full" style="width: 0%"></div>
            </div>
            <div class="text-right text-gray-400">Target: <span id="fi-target-value">0</span></div>
        </div>
    
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
            <div class="bg-gray-800 p-6 rounded-lg shadow-lg text-center">
                <h3 class="text-xl font-semibold mb-3 text-teal-400">Years to Retirement</h3>
                <p id="years-to-retirement" class="text-4xl font-bold">--</p>
            </div>
            <div class="bg-gray-800 p-6 rounded-lg shadow-lg text-center">
                <h3 class="text-xl font-semibold mb-3 text-teal-400">Target FI Date</h3>
                <p id="target-fi-date" class="text-4xl font-bold">----</p>
            </div>
        </div>
        
    <div class="bg-gray-800 p-6 rounded-lg shadow-lg text-center">
    <h3 class="text-xl font-semibold mb-3 text-teal-400">Selected Strategy</h3>
    <p id="strategy-label" class="text-xl font-medium text-white">Moderate (5% real return)</p>
</div>
        <div class="bg-gray-800 p-6 rounded-lg shadow-lg">
            <h3 class="text-xl font-semibold mb-4 text-center text-teal-400">Projected Wealth Growth</h3>
            <div id="wealth-chart-placeholder" class="bg-gray-700 h-64 rounded flex items-center justify-center">
                <p class="text-gray-500">Chart will be here</p>
            </div>
        </div>
    </div>
    
    </body>
    </html>
    
